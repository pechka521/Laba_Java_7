<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sunrise-Sunset Manager</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAA/4QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAAAAAAA" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen">
<div id="root"></div>
<script type="text/babel">
    const { useState, useEffect } = React;
    const { createRoot } = ReactDOM;

    const App = () => {
        const [sunriseSunsets, setSunriseSunsets] = useState([]);
        const [formData, setFormData] = useState({ id: null, date: '', latitude: null, longitude: null, sunrise: '', sunset: '' });
        const [isEditing, setIsEditing] = useState(false);
        const [error, setError] = useState(null);

        useEffect(() => {
            fetchSunriseSunsets();
        }, []);

        const fetchSunriseSunsets = async () => {
            try {
                const response = await axios.get('http://localhost:8080/api/sunrise-sunset');
                setSunriseSunsets(response.data);
            } catch (err) {
                setError('Не удалось загрузить записи sunrise/sunset');
                console.error('Ошибка при загрузке sunrise/sunset:', err);
            }
        };

        const handleInputChange = (e) => {
            const { name, value } = e.target;
            setFormData({ ...formData, [name]: name === 'latitude' || name === 'longitude' ? parseFloat(value) : value });
        };

        const handleSubmit = async (e) => {
            e.preventDefault();
            try {
                if (isEditing) {
                    await axios.put(`http://localhost:8080/api/sunrise-sunset/${formData.id}`, formData);
                } else {
                    await axios.post('http://localhost:8080/api/sunrise-sunset', formData);
                }
                fetchSunriseSunsets();
                resetForm();
            } catch (err) {
                setError('Не удалось сохранить запись');
                console.error('Ошибка при сохранении записи:', err.response?.data || err.message);
            }
        };

        const handleEdit = (sunriseSunset) => {
            setFormData({
                id: sunriseSunset.id,
                date: sunriseSunset.date,
                latitude: sunriseSunset.latitude,
                longitude: sunriseSunset.longitude,
                sunrise: sunriseSunset.sunrise,
                sunset: sunriseSunset.sunset
            });
            setIsEditing(true);
        };

        const handleDelete = async (id) => {
            try {
                await axios.delete(`http://localhost:8080/api/sunrise-sunset/${id}`);
                fetchSunriseSunsets();
            } catch (err) {
                setError('Не удалось удалить запись');
                console.error('Ошибка при удалении записи:', err);
            }
        };

        const resetForm = () => {
            setFormData({ id: null, date: '', latitude: null, longitude: null, sunrise: '', sunset: '' });
            setIsEditing(false);
        };

        return (
            <div className="container mx-auto p-4">
                <nav className="bg-blue-600 text-white p-4 rounded-md mb-6">
                    <h1 className="text-2xl font-bold">Менеджер Sunrise-Sunset</h1>
                </nav>

                {error && (
                    <div className="bg-red-100 text-red-700 p-4 rounded-md mb-6">
                        {error}
                    </div>
                )}

                <div className="bg-white p-6 rounded-md shadow-md mb-6">
                    <h2 className="text-xl font-semibold mb-4">{isEditing ? 'Обновить запись' : 'Добавить новую запись'}</h2>
                    <form onSubmit={handleSubmit} className="space-y-4">
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Дата</label>
                            <input
                                type="text"
                                name="date"
                                value={formData.date}
                                onChange={handleInputChange}
                                className="mt-1 block w-full p-2 border rounded-md"
                                required
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Широта (Latitude)</label>
                            <input
                                type="number"
                                step="any"
                                name="latitude"
                                value={formData.latitude || ''}
                                onChange={handleInputChange}
                                className="mt-1 block w-full p-2 border rounded-md"
                                required
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Долгота (Longitude)</label>
                            <input
                                type="number"
                                step="any"
                                name="longitude"
                                value={formData.longitude || ''}
                                onChange={handleInputChange}
                                className="mt-1 block w-full p-2 border rounded-md"
                                required
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Восход (Sunrise)</label>
                            <input
                                type="text"
                                name="sunrise"
                                value={formData.sunrise}
                                onChange={handleInputChange}
                                className="mt-1 block w-full p-2 border rounded-md"
                                required
                            />
                        </div>
                        <div>
                            <label className="block text-sm font-medium text-gray-700">Закат (Sunset)</label>
                            <input
                                type="text"
                                name="sunset"
                                value={formData.sunset}
                                onChange={handleInputChange}
                                className="mt-1 block w-full p-2 border rounded-md"
                                required
                            />
                        </div>
                        <div className="flex space-x-4">
                            <button
                                type="submit"
                                className="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700"
                            >
                                {isEditing ? 'Обновить' : 'Создать'}
                            </button>
                            {isEditing && (
                                <button
                                    type="button"
                                    onClick={resetForm}
                                    className="bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700"
                                >
                                    Отмена
                                </button>
                            )}
                        </div>
                    </form>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    {sunriseSunsets.map(sunriseSunset => (
                        <div key={sunriseSunset.id} className="bg-white p-6 rounded-md shadow-md">
                            <h3 className="text-lg font-semibold">Дата: {sunriseSunset.date}</h3>
                            <p className="text-gray-600">Широта: {sunriseSunset.latitude}</p>
                            <p className="text-gray-600">Долгота: {sunriseSunset.longitude}</p>
                            <p className="text-gray-600">Восход: {sunriseSunset.sunrise}</p>
                            <p className="text-gray-600">Закат: {sunriseSunset.sunset}</p>
                            <div className="mt-4 flex space-x-4">
                                <button
                                    onClick={() => handleEdit(sunriseSunset)}
                                    className="bg-yellow-500 text-white px-4 py-2 rounded-md hover:bg-yellow-600"
                                >
                                    Редактировать
                                </button>
                                <button
                                    onClick={() => handleDelete(sunriseSunset.id)}
                                    className="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600"
                                >
                                    Удалить
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>